"use strict";(self.webpackChunkio_github_lyrihkaesa=self.webpackChunkio_github_lyrihkaesa||[]).push([["2697"],{47966:function(e,n,r){r.r(n),r.d(n,{default:()=>u,frontMatter:()=>l,metadata:()=>s,assets:()=>d,toc:()=>o,contentTitle:()=>a});var s=JSON.parse('{"id":"flutter-starter-kit/api-design","title":"\uD83D\uDCD8 API Design Guide untuk Flutter Starter Kit","description":"(Laravel backend + Flutter frontend, support Sanctum & JWT Redis)","source":"@site/articles/flutter/01-flutter-starter-kit/92-api-design.md","sourceDirName":"01-flutter-starter-kit","slug":"/flutter-starter-kit/api-design","permalink":"/flutter/flutter-starter-kit/api-design","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":92,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tutorial Flutter dan Laravel API","permalink":"/flutter/flutter-starter-kit/flutter-x-laravel"},"next":{"title":"\uD83D\uDCDD Dokumentasi Form & Validation \u2013 Flutter Starter Kit","permalink":"/flutter/flutter-starter-kit/form"}}'),i=r("85893"),t=r("50065");let l={},a="\uD83D\uDCD8 API Design Guide untuk Flutter Starter Kit",d={},o=[{value:"1. Struktur Base URL",id:"1-struktur-base-url",level:2},{value:"2. Auth Flow Perbandingan",id:"2-auth-flow-perbandingan",level:2},{value:"\uD83D\uDD39 Sanctum",id:"-sanctum",level:3},{value:"\uD83D\uDD39 JWT + Redis",id:"-jwt--redis",level:3},{value:"3. Bentuk Response",id:"3-bentuk-response",level:2},{value:"Login sukses",id:"login-sukses",level:3},{value:"Refresh (JWT only)",id:"refresh-jwt-only",level:3},{value:"Error format",id:"error-format",level:3},{value:"4. Flutter Integration Guide",id:"4-flutter-integration-guide",level:2},{value:"\uD83D\uDD39 Interceptor Workflow",id:"-interceptor-workflow",level:3},{value:"5. Switching Strategy",id:"5-switching-strategy",level:2},{value:"6. Best Practice Checklist",id:"6-best-practice-checklist",level:2},{value:"\u2705 Response Sukses (Data Object)",id:"-response-sukses-data-object",level:2},{value:"\u2705 Response Sukses (Data List)",id:"-response-sukses-data-list",level:2},{value:"\u274C Response Error Validasi (Laravel-style)",id:"-response-error-validasi-laravel-style",level:2},{value:"\u274C Response Error Auth (OAuth2-style / JWT)",id:"-response-error-auth-oauth2-style--jwt",level:2},{value:"\uD83C\uDFD7\uFE0F Model Konseptual di Flutter",id:"\uFE0F-model-konseptual-di-flutter",level:2}];function c(e){let n={blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-api-design-guide-untuk-flutter-starter-kit",children:"\uD83D\uDCD8 API Design Guide untuk Flutter Starter Kit"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"(Laravel backend + Flutter frontend, support Sanctum & JWT Redis)"})}),"\n",(0,i.jsx)(n.h2,{id:"1-struktur-base-url",children:"1. Struktur Base URL"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Semua API prefiks di ",(0,i.jsx)(n.code,{children:"/api/v1"})]}),"\n",(0,i.jsxs)(n.li,{children:["Contoh:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Login \u2192 ",(0,i.jsx)(n.code,{children:"POST /api/v1/login"})]}),"\n",(0,i.jsxs)(n.li,{children:["Logout \u2192 ",(0,i.jsx)(n.code,{children:"POST /api/v1/logout"})]}),"\n",(0,i.jsxs)(n.li,{children:["Refresh (JWT only) \u2192 ",(0,i.jsx)(n.code,{children:"POST /api/v1/auth/refresh"})]}),"\n",(0,i.jsxs)(n.li,{children:["User profile \u2192 ",(0,i.jsx)(n.code,{children:"GET /api/v1/me"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"2-auth-flow-perbandingan",children:"2. Auth Flow Perbandingan"}),"\n",(0,i.jsx)(n.h3,{id:"-sanctum",children:"\uD83D\uDD39 Sanctum"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Token hanya ",(0,i.jsx)(n.strong,{children:"access token"})," \u2192 simpan DB"]}),"\n",(0,i.jsx)(n.li,{children:"Tidak ada refresh token."}),"\n",(0,i.jsx)(n.li,{children:"Token berlaku lama (atau sesuai config expiration)."}),"\n",(0,i.jsxs)(n.li,{children:["Logout \u2192 revoke token di server (",(0,i.jsx)(n.code,{children:"/logout"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"-jwt--redis",children:"\uD83D\uDD39 JWT + Redis"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ada ",(0,i.jsx)(n.strong,{children:"2 token"}),": ",(0,i.jsx)(n.code,{children:"access_token"})," (umur pendek, ex: 15 menit) + ",(0,i.jsx)(n.code,{children:"refresh_token"})," (umur panjang, ex: 7 hari)."]}),"\n",(0,i.jsx)(n.li,{children:"Keduanya disimpan di Redis whitelist dengan TTL."}),"\n",(0,i.jsxs)(n.li,{children:["Access token habis \u2192 pakai refresh token ke ",(0,i.jsx)(n.code,{children:"/auth/refresh"})," untuk issue baru."]}),"\n",(0,i.jsx)(n.li,{children:"Logout \u2192 hapus token di Redis whitelist."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-bentuk-response",children:"3. Bentuk Response"}),"\n",(0,i.jsx)(n.h3,{id:"login-sukses",children:"Login sukses"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sanctum:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "access_token": "xxx",\n    "token_type": "Bearer",\n    "user": {\n      "id": 1,\n      "email": "user@mail.com",\n      "name": "John"\n    }\n  },\n  "message": "Login success"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"JWT:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "access_token": "xxx",\n    "refresh_token": "yyy",\n    "token_type": "Bearer",\n	"expires_in": 900,\n    "user": {\n      "id": 1,\n      "email": "user@mail.com",\n      "name": "John"\n    }\n  },\n  "message": "Login success",\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"refresh-jwt-only",children:"Refresh (JWT only)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "new_access",\n  "refresh_token": "new_refresh",\n  "token_type": "Bearer",\n  "expires_in": 900\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"error-format",children:"Error format"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Auth (OAuth2-style):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "invalid_grant",\n  "error_description": "Invalid credentials"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation (Laravel default):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "message": "The given data was invalid.",\n  "errors": {\n    "email": ["The email field is required."]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-flutter-integration-guide",children:"4. Flutter Integration Guide"}),"\n",(0,i.jsxs)(n.p,{children:["Di Flutter Starter Kit kamu buat lapisan ",(0,i.jsx)(n.code,{children:"auth_repository.dart"})," \u2192 handle login, refresh, logout.",(0,i.jsx)(n.br,{}),"\n","Lalu di ",(0,i.jsx)(n.code,{children:"dio_interceptor.dart"})," atur ",(0,i.jsx)(n.code,{children:"Authorization"})," header."]}),"\n",(0,i.jsx)(n.h3,{id:"-interceptor-workflow",children:"\uD83D\uDD39 Interceptor Workflow"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Cek request path:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/login"}),", ",(0,i.jsx)(n.code,{children:"/register"}),", ",(0,i.jsx)(n.code,{children:"/forgot-password"})," \u2192 ",(0,i.jsx)(n.strong,{children:"tanpa Authorization"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["selain itu \u2192 tambahkan ",(0,i.jsx)(n.code,{children:"Authorization: Bearer {token}"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Kalau request dapat ",(0,i.jsx)(n.code,{children:"401 Unauthorized"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sanctum"})," \u2192 langsung logout (karena tidak ada refresh)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"JWT"})," \u2192 coba refresh token \u2192 ulangi request. Kalau gagal \u2192 logout."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-switching-strategy",children:"5. Switching Strategy"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Kalau developer mau ganti dari Sanctum ke JWT:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backend"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tambah endpoint ",(0,i.jsx)(n.code,{children:"/auth/refresh"})]}),"\n",(0,i.jsxs)(n.li,{children:["Issue refresh token di ",(0,i.jsx)(n.code,{children:"/login"})]}),"\n",(0,i.jsx)(n.li,{children:"Simpan access + refresh ke Redis"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frontend (Flutter)"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ganti bagian ",(0,i.jsx)(n.code,{children:"auth_repository"})," supaya simpan ",(0,i.jsx)(n.code,{children:"refresh_token"})," di secure storage."]}),"\n",(0,i.jsxs)(n.li,{children:["Update ",(0,i.jsx)(n.code,{children:"dio_interceptor"})," untuk handle refresh flow."]}),"\n",(0,i.jsx)(n.li,{children:"Tidak perlu ubah UI atau repository lain."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Kalau mau ganti dari JWT ke Sanctum:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Backend"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hilangkan refresh endpoint."}),"\n",(0,i.jsxs)(n.li,{children:["Login hanya return ",(0,i.jsx)(n.code,{children:"access_token"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Frontend"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hapus logika refresh token di interceptor."}),"\n",(0,i.jsx)(n.li,{children:"Logout cukup hapus access token."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"6-best-practice-checklist",children:"6. Best Practice Checklist"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Gunakan ",(0,i.jsx)(n.code,{children:"Bearer {token}"})," standar di header."]}),"\n",(0,i.jsxs)(n.li,{children:["Pisahkan error format:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Auth \u2192 pakai ",(0,i.jsx)(n.code,{children:"error"}),", ",(0,i.jsx)(n.code,{children:"error_description"})]}),"\n",(0,i.jsxs)(n.li,{children:["Validation \u2192 pakai ",(0,i.jsx)(n.code,{children:"message"}),", ",(0,i.jsx)(n.code,{children:"errors"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Selalu balikan ",(0,i.jsx)(n.code,{children:"token_type"})," di response (biar konsisten)."]}),"\n",(0,i.jsxs)(n.li,{children:["Simpan token di ",(0,i.jsx)(n.strong,{children:"SecureStorage"})," di Flutter, bukan SharedPrefs."]}),"\n",(0,i.jsxs)(n.li,{children:["Jangan campur user data dengan token di JWT mode (pakai ",(0,i.jsx)(n.code,{children:"/me"})," untuk fetch user)."]}),"\n",(0,i.jsx)(n.li,{children:"Di Redis: TTL harus sesuai expiry token \u2192 biar auto-expire."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-response-sukses-data-object",children:"\u2705 Response Sukses (Data Object)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "id": 1,\n    "email": "user@mail.com",\n    "name": "John Doe"\n  },\n  "errors": {},\n  "error": null,\n  "error_description": null,\n  "message": "Success",\n  "meta": {}\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-response-sukses-data-list",children:"\u2705 Response Sukses (Data List)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": [\n    {\n      "id": 1,\n      "email": "user1@mail.com",\n      "name": "John Doe",\n      "can": {\n	      "edit": true,\n	      "delete": true,\n	      "publish": true,\n      },\n    },\n    {\n      "id": 2,\n      "email": "user2@mail.com",\n      "name": "Jane Smith",\n      "can": {\n	      "edit": true,\n	      "delete": true,\n	      "publish": true,\n      },\n    }\n  ],\n  "errors": {},\n  "error": null,\n  "error_description": null,\n  "message": "List fetched successfully",\n  "meta": {\n    "current_page": 1,\n    "last_page": 10,\n    "per_page": 20,\n    "total": 200\n  }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-response-error-validasi-laravel-style",children:"\u274C Response Error Validasi (Laravel-style)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": {\n    "email": [\n      "The email field is required.",\n      "The email must be a valid email address."\n    ],\n    "password": [\n      "The password must be at least 8 characters."\n    ]\n  },\n  "error": null,\n  "error_description": null,\n  "message": "The given data was invalid.",\n  "meta": {}\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-response-error-auth-oauth2-style--jwt",children:"\u274C Response Error Auth (OAuth2-style / JWT)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": null,\n  "errors": {},\n  "error": "invalid_grant",\n  "error_description": "Invalid username or password",\n  "message": "Authentication failed",\n  "meta": {}\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uFE0F-model-konseptual-di-flutter",children:"\uD83C\uDFD7\uFE0F Model Konseptual di Flutter"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"class ResponseModel<T> {\n  final T? data; // Bisa object atau list\n  final Map<String, List<String>>? errors; // Validasi Laravel\n  final String? error; // OAuth2/JWT error\n  final String? errorDescription; // OAuth2/JWT error description\n  final String? message; // Pesan umum\n  final Map<String, dynamic>? meta; // Pagination, dsb.\n\n  ResponseModel({\n    this.data,\n    this.errors,\n    this.error,\n    this.errorDescription,\n    this.message,\n    this.meta,\n  });\n\n  factory ResponseModel.fromJson(\n      Map<String, dynamic> json,\n      T Function(Object? json) fromJsonT,\n  ) {\n    return ResponseModel<T>(\n      data: json['data'] != null ? fromJsonT(json['data']) : null,\n      errors: (json['errors'] as Map?)?.map(\n        (key, value) => MapEntry(key as String, List<String>.from(value)),\n      ),\n      error: json['error'] as String?,\n      errorDescription: json['error_description'] as String?,\n      message: json['message'] as String?,\n      meta: json['meta'] as Map<String, dynamic>?,\n    );\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Dengan pola ini, ",(0,i.jsx)(n.code,{children:"ResponseModel<User>"})," atau ",(0,i.jsx)(n.code,{children:"ResponseModel<List<User>>"})," bisa dipakai sama tanpa perlu bikin banyak model response."]}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},50065:function(e,n,r){r.d(n,{Z:function(){return a},a:function(){return l}});var s=r(67294);let i={},t=s.createContext(i);function l(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);