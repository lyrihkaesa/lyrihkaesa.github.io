"use strict";(self.webpackChunkio_github_lyrihkaesa=self.webpackChunkio_github_lyrihkaesa||[]).push([["3262"],{98542:function(e,r,a){a.r(r),a.d(r,{default:()=>c,frontMatter:()=>s,metadata:()=>n,assets:()=>o,toc:()=>d,contentTitle:()=>i});var n=JSON.parse('{"id":"laravel-filesystem-local-temporary-url","title":"Laravel Filesystem local storage temporaryUrl()","description":"Above Laravel  v11.23","source":"@site/articles/laravel/22-laravel-filesystem-local-temporary-url.md","sourceDirName":".","slug":"/laravel-filesystem-local-temporary-url","permalink":"/laravel/laravel-filesystem-local-temporary-url","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"MinIO Laravel","permalink":"/laravel/minio-laravel"},"next":{"title":"Deploy VPS","permalink":"/laravel/deploy-vps"}}'),l=a("85893"),t=a("50065");let s={},i="Laravel Filesystem local storage temporaryUrl()",o={},d=[{value:"Above Laravel  <code>v11.23</code>",id:"above-laravel--v1123",level:2},{value:"Before Laravel  <code>v11.23</code>",id:"before-laravel--v1123",level:2},{value:"Menggunakan Proxy Server seperti <code>Nginx Proxy Manager</code>",id:"menggunakan-proxy-server-seperti-nginx-proxy-manager",level:2}];function p(e){let r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.header,{children:(0,l.jsxs)(r.h1,{id:"laravel-filesystem-local-storage-temporaryurl",children:["Laravel Filesystem local storage ",(0,l.jsx)(r.code,{children:"temporaryUrl()"})]})}),"\n",(0,l.jsxs)(r.h2,{id:"above-laravel--v1123",children:["Above Laravel  ",(0,l.jsx)(r.a,{href:"https://github.com/laravel/framework/tree/v11.23.0",children:(0,l.jsx)(r.code,{children:"v11.23"})})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"config/filesystems.php"})}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:"'local' => [\r\n    'driver' => 'local',\r\n    'root' => storage_path('app'),\r\n    'serve' => true, # Change this to true if it's false in your case (add it line if it's not there)\r\n    'throw' => false,\r\n],\n"})}),"\n",(0,l.jsxs)(r.h2,{id:"before-laravel--v1123",children:["Before Laravel  ",(0,l.jsx)(r.a,{href:"https://github.com/laravel/framework/tree/v11.23.0",children:(0,l.jsx)(r.code,{children:"v11.23"})})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"app\\Providers\\AppServiceProvider.php"})}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:" if (! ($this->app instanceof \\Illuminate\\Contracts\\Foundation\\CachesRoutes && $this->app->routesAreCached())) {\r\n            \\Illuminate\\Support\\Facades\\Route::get('local/temp/{path}', function (string $path): \\Symfony\\Component\\HttpFoundation\\StreamedResponse {\r\n                /** @var \\Illuminate\\Filesystem\\FilesystemAdapter $disk */\r\n                $disk = \\Illuminate\\Support\\Facades\\Storage::disk('local');\r\n\r\n                return $disk->download($path);\r\n            })\r\n                ->where('path', '.*')\r\n                ->name('local.temp')\r\n                ->middleware(['web', 'signed']);\r\n        }\r\n\r\n        /** @var \\Illuminate\\Filesystem\\FilesystemAdapter $disk */\r\n        $disk = \\Illuminate\\Support\\Facades\\Storage::disk('local');\r\n        $disk->buildTemporaryUrlsUsing(\r\n            function (string $path, \\DateTimeInterface $expiration, array $options = []) {\r\n                return URL::temporarySignedRoute(\r\n                    'local.temp',\r\n                    $expiration,\r\n                    array_merge($options, ['path' => $path])\r\n                );\r\n            }\r\n        );\n"})}),"\n",(0,l.jsxs)(r.h2,{id:"menggunakan-proxy-server-seperti-nginx-proxy-manager",children:["Menggunakan Proxy Server seperti ",(0,l.jsx)(r.code,{children:"Nginx Proxy Manager"})]}),"\n",(0,l.jsxs)(r.p,{children:["Jika menggunakan ",(0,l.jsx)(r.code,{children:"Nginx Proxy Manager"})," atau proxy server perlu ubah:"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"app\\Http\\Middleware\\TrustProxies.php"})}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:"<?php\r\n\r\nnamespace App\\Http\\Middleware;\r\n\r\nuse Illuminate\\Http\\Middleware\\TrustProxies as Middleware;\r\nuse Illuminate\\Http\\Request;\r\n\r\nclass TrustProxies extends Middleware\r\n{\r\n    /**\r\n     * The trusted proxies for this application.\r\n     *\r\n     * @var array<int, string>|string|null\r\n     */\r\n    // protected $proxies; // Default\r\n    protected $proxies = '*'; // All proxy allowed using willcard\r\n    // Best partice using ip address proxy server like nginx proxy manager\r\n    // protected $proxies = ['90.90.90.90', '127.0.0.1']; // example\r\n\r\n    /**\r\n     * The headers that should be used to detect proxies.\r\n     *\r\n     * @var int\r\n     */\r\n    protected $headers =\r\n    Request::HEADER_X_FORWARDED_FOR |\r\n        Request::HEADER_X_FORWARDED_HOST |\r\n        Request::HEADER_X_FORWARDED_PORT |\r\n        Request::HEADER_X_FORWARDED_PROTO |\r\n        Request::HEADER_X_FORWARDED_AWS_ELB;\r\n}\r\n\n"})}),"\n",(0,l.jsx)(r.p,{children:"Cara menggunakan:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:"echo \\Illuminate\\Support\\Facades\\Storage::temporaryUrl('private-folder/image-private-name.jpg', now()->addMinutes(30));\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:"echo \\Illuminate\\Support\\Facades\\Storage::disk('local')->temporaryUrl('private-folder/image-private-name.jpg', now()->addMinutes(30));\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-php",children:"/** @var \\Illuminate\\Filesystem\\FilesystemAdapter $disk */\r\n$disk = \\Illuminate\\Support\\Facades\\Storage::disk('local');\r\n\r\necho $disk->temporaryUrl('private-folder/image-private-name.jpg', now()->addMinutes(30));\n"})})]})}function c(e={}){let{wrapper:r}={...(0,t.a)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},50065:function(e,r,a){a.d(r,{Z:function(){return i},a:function(){return s}});var n=a(67294);let l={},t=n.createContext(l);function s(e){let r=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),n.createElement(t.Provider,{value:r},e.children)}}}]);